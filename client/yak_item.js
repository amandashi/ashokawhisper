Template.yakItem.events({click:function(){Session.set("selected_yak",this._id)},"click a.yes":function(){if(Meteor.user()){var e=Yaks.findOne({_id:this._id});if(-1!==$.inArray(Meteor.userId(),e.voted))console.log("User already voted");else{var o=Session.get("selected_yak");console.log("Voting"),Yaks.update(o,{$inc:{score:1}}),Yaks.update(o,{$addToSet:{voted:Meteor.userId()}})}}},"click a.no":function(){if(Meteor.user()){var e=Yaks.findOne({_id:this._id});if(-1!==$.inArray(Meteor.userId(),e.voted))console.log("User already voted");else{var o=Session.get("selected_yak");console.log("Voting"),Yaks.update(o,{$inc:{score:-1}}),Yaks.update(o,{$addToSet:{voted:Meteor.userId()}}),e.score<=-20&&(console.log("delete"),Yaks.remove({_id:this._id}))}}}}),Template.yakItem.helpers({commentsCount:function(){return Comments.find({postId:this._id}).count()}});
